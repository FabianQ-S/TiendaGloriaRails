<% if batch.errors.any? %>
  <div class="form-errors">
    <ul>
      <% batch.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
    </ul>
  </div>
<% end %>

<%= form_with model: [:admin, batch], local: true do |f| %>
  <% if batch.product_id.present? && batch.new_record? %>
    <%= f.hidden_field :return_to_product, value: "1" %>
    <div class="form-group">
      <label class="form-label">ğŸ“¦ Producto</label>
      <p style="padding: 0.75rem; background: var(--gloria-gray-light); border-radius: 4px;">
        <strong><%= batch.product.name %></strong> (SKU: <%= batch.product.sku %>)
      </p>
      <%= f.hidden_field :product_id %>
    </div>
  <% else %>
    <div class="form-group">
      <label class="form-label">ğŸ“¦ Producto</label>
      <%= f.collection_select :product_id, Product.order(:name), :id, :name, { include_blank: "Seleccionar producto" }, { class: "form-control", required: true } %>
    </div>
  <% end %>
  
  <div class="form-group">
    <label class="form-label">ğŸ“ NÃºmero de Lote</label>
    <%= f.text_field :batch_number, class: "form-control", required: true %>
  </div>
  
  <div class="form-group">
    <label class="form-label">ğŸ“¦ Cantidad</label>
    <%= f.number_field :quantity, class: "form-control", min: 0, required: true %>
  </div>
  
  <div class="form-group">
    <label class="form-label">ğŸ“… Fecha de Vencimiento</label>
    <%= f.date_field :expiration_date, class: "form-control", required: true %>
  </div>
  
  <div class="form-actions">
    <% if batch.product_id.present? && batch.new_record? %>
      <a href="<%= admin_product_path(batch.product) %>" class="btn btn-secondary">â† Volver al Producto</a>
    <% else %>
      <a href="<%= admin_batches_path %>" class="btn btn-secondary">Cancelar</a>
    <% end %>
    <%= f.submit "Guardar", class: "btn btn-success" %>
  </div>
<% end %>
