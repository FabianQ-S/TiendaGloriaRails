<% if params[:delete_error] == "batch_with_products" %>
<script>
  window.onload = function() {
    alert("‚ö†Ô∏è IMPOSIBLE ELIMINAR ‚ö†Ô∏è\n\nEl lote '<%= params[:name] %>' tiene <%= params[:count] %> producto(s) relacionado(s).\n\nNo se puede eliminar un lote vigente con productos.");
  };
</script>
<% elsif params[:delete_error] == "batch_expired_with_products" %>
<form id="delete-expired-form" action="<%= admin_batch_path(params[:batch_id]) %>" method="post" style="display: none;">
  <input type="hidden" name="_method" value="delete">
  <input type="hidden" name="confirm_expired" value="1">
  <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
</form>
<script>
  window.onload = function() {
    if (confirm("‚ö†Ô∏è LOTE VENCIDO ‚ö†Ô∏è\n\nEl lote '<%= params[:name] %>' tiene <%= params[:count] %> producto(s) relacionado(s).\n\n¬øDesea eliminar el lote VENCIDO junto con todos sus productos?")) {
      document.getElementById('delete-expired-form').submit();
    }
  };
</script>
<% end %>

<div class="admin-header">
  <h1 class="admin-title">üìã Lotes</h1>
  <a href="<%= new_admin_batch_path %>" class="btn btn-success">‚ûï Nuevo Lote</a>
</div>

<div class="table-container">
  <% if @batches.any? %>
    <table class="table">
      <thead>
        <tr>
          <th>N¬∫ Lote</th>
          <th>Cantidad</th>
          <th>Vencimiento</th>
          <th>Estado</th>
          <th>Productos</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <% @batches.each do |batch| %>
          <tr>
            <td><strong><%= batch.batch_number %></strong></td>
            <td><%= batch.quantity %></td>
            <td><%= batch.expiration_date&.strftime("%d/%m/%Y") %></td>
            <td>
              <% if batch.expired? %>
                <span style="color: var(--gloria-danger);">‚ö†Ô∏è Vencido</span>
              <% elsif batch.expiring_soon? %>
                <span style="color: var(--gloria-warning);">‚ö° Por vencer</span>
              <% else %>
                <span style="color: var(--gloria-success);">‚úì Vigente</span>
              <% end %>
            </td>
            <td>
              <% if batch.products.any? %>
                <span style="color: var(--gloria-blue-dark);"><%= batch.products.count %> producto(s)</span>
              <% else %>
                <span style="color: #999;">Sin productos</span>
              <% end %>
            </td>
            <td class="table-actions">
              <a href="<%= edit_admin_batch_path(batch) %>" class="btn btn-primary btn-sm">‚úèÔ∏è</a>
              <%= button_to "üóëÔ∏è", admin_batch_path(batch), method: :delete, class: "btn btn-danger btn-sm", data: { turbo: false, confirm: "¬øEliminar este lote?" } %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% else %>
    <div class="empty-state">
      <div class="empty-state-icon">üìã</div>
      <h3 class="empty-state-title">No hay lotes</h3>
      <a href="<%= new_admin_batch_path %>" class="btn btn-primary mt-2">Crear primer lote</a>
    </div>
  <% end %>
</div>
