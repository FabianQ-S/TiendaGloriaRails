<% if params[:purchased] == "true" %>
<script>
  // Vanilla JS popup - runs on page load (Turbo disabled for checkout)
  window.onload = function() {
    alert("ðŸŽ‰ Â¡HAS COMPRADO! ðŸŽ‰\n\nGracias por tu compra.\nTotal: S/ <%= params[:total] %>\n\nÂ¡Pronto recibirÃ¡s tus productos Gloria!");
  };
</script>
<% end %>

<div class="page-header">
  <h1 class="page-title">ðŸ¥› Productos LÃ¡cteos Gloria</h1>
  <p class="page-subtitle">Los mejores productos lÃ¡cteos del PerÃº</p>
</div>

<div class="search-filters">
  <%= form_with url: root_path, method: :get, local: true, data: { turbo: false } do |f| %>
    <%= text_field_tag :search, params[:search], placeholder: "ðŸ” Buscar productos...", class: "search-input" %>
    
    <%= select_tag :category_id, 
        options_from_collection_for_select(@categories, :id, :name, params[:category_id]),
        include_blank: "ðŸ“‚ Todas las categorÃ­as",
        class: "filter-select",
        onchange: "this.form.submit()" %>
    
    <%= submit_tag "Buscar", class: "btn btn-primary" %>
  <% end %>
</div>

<% if @products.any? %>
  <div class="products-grid">
    <% @products.each do |product| %>
      <div class="card">
        <div class="card-image">
          <% if product.image.attached? %>
            <%= image_tag product.image, style: "width: 100%; height: 200px; object-fit: cover;" %>
          <% elsif product.image_url.present? %>
            <img src="<%= product.image_url %>" alt="<%= product.name %>" style="width: 100%; height: 200px; object-fit: cover;">
          <% else %>
            ðŸ§€
          <% end %>
        </div>
        
        <div class="card-body">
          <h3 class="card-title"><%= product.name %></h3>
          <p class="card-text">
            <small>ðŸ“‚ <%= product.category&.name || "Sin categorÃ­a" %></small>
          </p>
          <p class="card-text"><%= truncate(product.description, length: 80) %></p>
          <p class="card-price">S/ <%= number_with_precision(product.price, precision: 2) %></p>
        </div>
        
        <div class="card-footer">
          <%= button_to "ðŸ›’ Agregar al carrito", add_to_cart_path(product), method: :post, class: "btn btn-success", style: "width: 100%;" %>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="empty-state">
    <div class="empty-state-icon">ðŸ¥›</div>
    <h3 class="empty-state-title">No hay productos disponibles</h3>
    <p>Pronto tendremos mÃ¡s productos lÃ¡cteos para ti.</p>
  </div>
<% end %>
